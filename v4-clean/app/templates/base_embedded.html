<!-- Base template for embedded analysis results -->
<style>
    .premium-results {
        padding: 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        max-width: 1200px;
        margin: 0 auto;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
    }
    
    .premium-header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #667eea;
    }
    
    .premium-header h2 {
        color: #667eea;
        margin: 0;
        font-size: 1.8rem;
        font-weight: 700;
    }
    
    .premium-header p {
        color: #666;
        margin: 10px 0 0 0;
        font-size: 1rem;
    }
    
    .section {
        margin-bottom: 30px;
    }
    
    .section h3 {
        color: #667eea;
        font-size: 1.4rem;
        margin-bottom: 15px;
        border-bottom: 1px solid #667eea;
        padding-bottom: 8px;
        font-weight: 600;
    }
    
    .section h4 {
        color: #333;
        font-size: 1.1rem;
        margin-bottom: 10px;
        margin-top: 15px;
        font-weight: 600;
    }
    
    .content-block {
        background: #f8f9ff;
        padding: 20px;
        border-radius: 8px;
        border-left: 4px solid #667eea;
        line-height: 1.6;
        margin: 15px 0;
    }
    
    .highlight-box {
        background: #e8f5e8;
        padding: 15px;
        border-radius: 6px;
        border-left: 3px solid #28a745;
        margin: 12px 0;
    }
    
    .warning-box {
        background: #fff3cd;
        padding: 15px;
        border-radius: 6px;
        border-left: 3px solid #ffc107;
        margin: 12px 0;
    }
    
    .error-box {
        background: #f8d7da;
        padding: 15px;
        border-radius: 6px;
        border-left: 3px solid #dc3545;
        margin: 12px 0;
    }
    
    .info-box {
        background: #d1ecf1;
        padding: 15px;
        border-radius: 6px;
        border-left: 3px solid #17a2b8;
        margin: 12px 0;
    }
    
    .grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin: 15px 0;
    }
    
    .grid-3 {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin: 15px 0;
    }
    
    @media (max-width: 768px) {
        .grid-2, .grid-3 {
            grid-template-columns: 1fr;
        }
    }
    
    .score-badge {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
        text-align: center;
        min-width: 60px;
    }
    
    .score-excellent {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
    }
    
    .score-good {
        background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        color: white;
    }
    
    .score-fair {
        background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
        color: #333;
    }
    
    .score-poor {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        color: white;
    }
    
    .bullet-list {
        list-style: none;
        padding: 0;
        margin: 10px 0;
    }
    
    .bullet-list li {
        padding: 6px 0 6px 20px;
        position: relative;
        line-height: 1.5;
    }
    
    .bullet-list li:before {
        content: "•";
        color: #667eea;
        font-weight: bold;
        position: absolute;
        left: 0;
        top: 6px;
    }
    
    .numbered-list {
        counter-reset: item;
        list-style: none;
        padding: 0;
    }
    
    .numbered-list li {
        counter-increment: item;
        padding: 8px 0 8px 30px;
        position: relative;
        line-height: 1.5;
    }
    
    .numbered-list li:before {
        content: counter(item);
        background: #667eea;
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: absolute;
        left: 0;
        top: 8px;
        font-size: 0.8rem;
        font-weight: bold;
    }
    
    .actions {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #e0e0e0;
    }
    
    .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        margin: 6px;
        text-decoration: none;
        display: inline-block;
        transition: all 0.2s ease;
    }
    
    .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .btn:active {
        transform: translateY(0);
    }
    
    .btn-success {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    }
    
    .btn-success:hover {
        box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
    }
    
    .btn-info {
        background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
    }
    
    .btn-info:hover {
        box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
    }
    
    .btn-warning {
        background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
        color: #333;
    }
    
    .btn-warning:hover {
        box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
    }
    
    .btn-danger {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    }
    
    .btn-danger:hover {
        box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
    }
    
    /* Progress bars */
    .progress-container {
        background: #e9ecef;
        border-radius: 10px;
        overflow: hidden;
        margin: 10px 0;
        height: 20px;
    }
    
    .progress-bar {
        height: 100%;
        transition: width 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        font-weight: 600;
        color: white;
        text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }
    
    .progress-excellent {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    }
    
    .progress-good {
        background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
    }
    
    .progress-fair {
        background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
    }
    
    .progress-poor {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    }
    
    /* Print styles */
    @media print {
        .actions {
            display: none !important;
        }
        
        .premium-results {
            background: white !important;
            box-shadow: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        
        body {
            background: white !important;
            margin: 0;
            padding: 15px;
            font-size: 11pt;
            line-height: 1.4;
            color: #000 !important;
        }
        
        .section {
            break-inside: avoid;
            margin-bottom: 20px;
        }
        
        .premium-header {
            border-bottom: 2px solid #000;
        }
        
        .premium-header h2 {
            color: #000 !important;
        }
        
        .section h3 {
            color: #000 !important;
            border-bottom: 1px solid #000;
        }
        
        .content-block, .highlight-box, .warning-box, .error-box, .info-box {
            border: 1px solid #ccc;
            background: #f9f9f9 !important;
            color: #000 !important;
        }
        
        .score-badge {
            border: 1px solid #ccc !important;
            background: #f0f0f0 !important;
            color: #000 !important;
        }
        
        .btn, button, .actions, [onclick], [class*="btn"] {
            display: none !important;
        }
    }
</style>

<script>
    // Common export functions for all templates
    function copyToClipboard(elementSelector) {
        const element = document.querySelector(elementSelector);
        if (!element) {
            alert('❌ Content not found to copy.');
            return;
        }
        
        const content = element.textContent || element.innerText;
        navigator.clipboard.writeText(content).then(() => {
            alert('✅ Content copied to clipboard!');
        }).catch(err => {
            console.error('Failed to copy: ', err);
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = content;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                alert('✅ Content copied to clipboard!');
            } catch (err) {
                alert('❌ Failed to copy to clipboard. Please select and copy manually.');
            }
            document.body.removeChild(textArea);
        });
    }
    
    function exportToPDF(analysisId = null) {
        // Show loading message
        const pdfBtn = document.querySelector('.btn-danger, .pdf-btn, [onclick*="exportToPDF"]');
        if (pdfBtn) {
            const originalText = pdfBtn.textContent;
            pdfBtn.textContent = '⏳ Generating PDF...';
            pdfBtn.disabled = true;
            
            setTimeout(() => {
                pdfBtn.textContent = originalText;
                pdfBtn.disabled = false;
            }, 3000);
        }
        
        try {
            // Check if jsPDF is available
            if (typeof window.jspdf === 'undefined' || !window.jspdf.jsPDF) {
                console.log('jsPDF not available, using fallback');
                exportToPDFFallback();
                return;
            }
            
            // Get the content to export and clean it
            const content = document.querySelector('.premium-results');
            
            // Temporarily hide action buttons for clean screenshot
            const actionElements = document.querySelectorAll('.actions, .btn, button, [onclick]');
            actionElements.forEach(element => {
                element.style.display = 'none';
            });
            
            // Use html2canvas to capture the content
            html2canvas(content, {
                scale: 2,
                useCORS: true,
                allowTaint: true,
                backgroundColor: '#ffffff',
                width: content.scrollWidth,
                height: content.scrollHeight
            }).then(canvas => {
                try {
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    
                    const imgData = canvas.toDataURL('image/png');
                    const imgWidth = 190; // A4 width in mm minus margins
                    const pageHeight = 290; // A4 height in mm minus margins
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    let heightLeft = imgHeight;
                    
                    let position = 10; // Start 10mm from top
                    
                    // Add first page
                    pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                    
                    // Add additional pages if needed
                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight + 10;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }
                    
                    // Save the PDF with appropriate filename
                    const filename = getFilename('pdf', analysisId);
                    pdf.save(filename);
                    
                } catch (error) {
                    console.error('PDF generation error:', error);
                    alert('Error generating PDF. Please try the fallback option.');
                    exportToPDFFallback();
                } finally {
                    // Restore hidden action buttons
                    actionElements.forEach(element => {
                        element.style.display = '';
                    });
                }
                
            }).catch(error => {
                console.error('html2canvas error:', error);
                alert('Error capturing content. Using fallback method.');
                exportToPDFFallback();
            }).finally(() => {
                // Restore hidden action buttons in case of error
                actionElements.forEach(element => {
                    element.style.display = '';
                });
            });
            
        } catch (error) {
            console.error('exportToPDF error:', error);
            // Restore buttons if error occurs before html2canvas
            const actionElements = document.querySelectorAll('.actions, .btn, button, [onclick]');
            actionElements.forEach(element => {
                element.style.display = '';
            });
            exportToPDFFallback();
        }
    }
    
    function exportToPDFFallback(analysisId = null) {
        // Get the content to export
        const content = document.querySelector('.premium-results');
        const title = document.querySelector('.premium-header h2')?.textContent || 'Analysis Results';
        
        // Create a new window with PDF-optimized content
        const printWindow = window.open('', '_blank');
        const filename = getFilename('pdf', analysisId);
        
        printWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>${title}</title>
                <meta charset="utf-8">
                <style>
                    body { 
                        font-family: Arial, sans-serif; 
                        margin: 20px;
                        line-height: 1.6;
                        color: #333;
                    }
                    .premium-results { background: white; }
                    .actions { display: none !important; }
                    .btn { display: none !important; }
                    button { display: none !important; }
                    .action-btn { display: none !important; }
                    [onclick] { display: none !important; }
                    [class*="action"] { display: none !important; }
                    [class*="btn"] { display: none !important; }
                    .premium-header h2 {
                        color: #2c3e50;
                        text-align: center;
                        border-bottom: 2px solid #2c3e50;
                        padding-bottom: 10px;
                    }
                    .section h3 {
                        color: #2c3e50;
                        border-bottom: 1px solid #2c3e50;
                        padding-bottom: 5px;
                    }
                    .content-block, .highlight-box, .warning-box, .error-box, .info-box {
                        background: #f8f9fa;
                        padding: 10px;
                        margin: 10px 0;
                        border-left: 3px solid #007bff;
                        border-radius: 4px;
                    }
                    .bullet-list { list-style-type: disc; padding-left: 20px; }
                    .bullet-list li { margin: 5px 0; }
                    @media print {
                        body { margin: 0; }
                        @page { margin: 2cm; }
                    }
                </style>
            </head>
            <body>
                <div class="pdf-header" style="text-align: center; margin-bottom: 30px; padding: 20px; border-bottom: 2px solid #2c3e50;">
                    <h1 style="color: #2c3e50; margin: 0; font-size: 24px;">${title}</h1>
                    <p style="color: #888; font-size: 12px; margin-top: 10px;">To save as PDF: Press Cmd+P (Mac) or Ctrl+P (Windows), then choose "Save as PDF"</p>
                </div>
                ${content.innerHTML}
            </body>
            </html>
        `);
        printWindow.document.close();
        printWindow.focus();
    }
    
    function exportToWord(analysisId = null) {
        // Get the content to export
        const content = document.querySelector('.premium-results');
        const title = document.querySelector('.premium-header h2')?.textContent || 'Analysis Results';
        
        // Clone the content and modify for export
        const clonedContent = content.cloneNode(true);
        
        // Remove interactive elements - more comprehensive removal
        const elementsToRemove = clonedContent.querySelectorAll('.actions, .btn, button, .action-btn, [onclick]');
        elementsToRemove.forEach(element => {
            element.remove();
        });
        
        // Also remove any remaining action-related elements
        const actionElements = clonedContent.querySelectorAll('[class*="action"], [class*="btn"]');
        actionElements.forEach(element => {
            element.remove();
        });
        
        // Create HTML content for Word
        const htmlContent = `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="utf-8">
                <title>${title}</title>
                <style>
                    body { 
                        font-family: 'Times New Roman', serif; 
                        line-height: 1.6; 
                        margin: 40px;
                        color: #333;
                    }
                    .premium-header h2 {
                        color: #2c3e50;
                        text-align: center;
                        border-bottom: 2px solid #2c3e50;
                        padding-bottom: 10px;
                    }
                    .section h3 {
                        color: #2c3e50;
                        border-bottom: 1px solid #2c3e50;
                        padding-bottom: 5px;
                    }
                    .content-block, .highlight-box, .warning-box, .error-box, .info-box {
                        background: #f8f9fa;
                        padding: 10px;
                        margin: 10px 0;
                        border-left: 3px solid #007bff;
                    }
                    .bullet-list li {
                        margin: 5px 0;
                    }
                </style>
            </head>
            <body>
                ${clonedContent.outerHTML}
            </body>
            </html>
        `;
        
        // Create RTF content for better Word compatibility
        const rtfContent = convertHtmlToRtf(clonedContent.textContent || clonedContent.innerText, title);
        
        // Create blob with RTF format but use .doc extension for Word compatibility
        const blob = new Blob([rtfContent], {
            type: 'application/msword'
        });
        
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = getFilename('doc', analysisId);
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
    
    function convertHtmlToRtf(textContent, title) {
        // Clean and structure the text content
        const cleanText = textContent
            .replace(/\s+/g, ' ')  // Normalize whitespace
            .replace(/^\s+|\s+$/g, '')  // Trim
            .replace(/\n\s*\n/g, '\n\n')  // Clean up line breaks
            .replace(/[{}\\]/g, '')  // Remove RTF special characters
            .replace(/[\u0080-\uFFFF]/g, '?');  // Replace non-ASCII characters
        
        // Create Word-compatible RTF document
        const rtfHeader = `{\\rtf1\\ansi\\deff0\\deflang1033{\\fonttbl{\\f0\\fmodern\\fcharset0 Times New Roman;}{\\f1\\fswiss\\fcharset0 Arial;}}`;
        
        // Document margins and settings
        const docSettings = `\\margl1440\\margr1440\\margt1440\\margb1440\\widowctrl\\ftnbj\\aenddoc\\noxlattoyen\\expshrtn\\noultrlspc\\dntblnsbdb\\nospaceforul\\formshade\\horzdoc\\dgmargin\\dghspace180\\dgvspace180\\dghorigin1440\\dgvorigin1440\\dghshow1\\dgvshow1\\jexpand\\viewkind1\\viewscale100\\pgbrdrhead\\pgbrdrfoot\\splytwnine\\ftnlytwnine\\htmautsp\\nolnhtadjtbl\\urtf\\urtfftn\\utnp`;
        
        // Title with proper Word formatting
        const rtfTitle = `\\f0\\fs32\\b\\qc ${title}\\b0\\fs24\\ql\\par\\par`;
        
        // Process content with better formatting
        const paragraphs = cleanText.split(/(?:\r?\n){2,}/);
        let rtfBody = '';
        
        paragraphs.forEach(paragraph => {
            const trimmed = paragraph.trim();
            if (trimmed.length > 0) {
                // Check if it's likely a heading (short and starts with common heading words)
                const isHeading = trimmed.length < 100 && 
                    /^(Overall|Key|Matching|Areas|Recommendations|Interview|ATS|Text|Job|Cover|Resume)/i.test(trimmed);
                
                if (isHeading) {
                    rtfBody += `\\fs28\\b ${trimmed}\\b0\\fs24\\par\\par`;
                } else {
                    // Split into lines for bullet points
                    const lines = trimmed.split(/\r?\n/);
                    lines.forEach(line => {
                        const cleanLine = line.trim();
                        if (cleanLine.length > 0) {
                            rtfBody += `${cleanLine}\\par`;
                        }
                    });
                    rtfBody += '\\par';
                }
            }
        });
        
        const rtfFooter = `}`;
        
        return rtfHeader + docSettings + rtfTitle + rtfBody + rtfFooter;
    }
    
    function getFilename(extension, analysisId = null) {
        const title = document.querySelector('.premium-header h2')?.textContent || 'Analysis_Results';
        const cleanTitle = title.replace(/[^\w\s-]/g, '').replace(/\s+/g, '_');
        const timestamp = new Date().toISOString().slice(0, 10);
        
        if (analysisId) {
            return `${cleanTitle}_${analysisId}_${timestamp}.${extension}`;
        }
        return `${cleanTitle}_${timestamp}.${extension}`;
    }
    
    // Utility function to format scores with appropriate styling
    function getScoreClass(score) {
        if (score >= 85) return 'score-excellent';
        if (score >= 70) return 'score-good';
        if (score >= 50) return 'score-fair';
        return 'score-poor';
    }
    
    // Utility function to format progress bar styling
    function getProgressClass(score) {
        if (score >= 85) return 'progress-excellent';
        if (score >= 70) return 'progress-good';
        if (score >= 50) return 'progress-fair';
        return 'progress-poor';
    }
</script>

<!-- Load external libraries for PDF generation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
