    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Resume Health Checker - Get More Interviews</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                color: #333;
            }
            
            .container {
                max-width: 800px;
                margin: 0 auto;
                padding: 2rem;
            }
            
            .header {
                text-align: center;
                color: white;
                margin-bottom: 3rem;
            }
            
            .header h1 {
                font-size: 2.8rem;
                margin-bottom: 0.5rem;
                font-weight: 700;
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            .header p {
                font-size: 1.3rem;
                opacity: 0.9;
                margin-bottom: 1rem;
            }
            
            .header .subtitle {
                font-size: 1rem;
                opacity: 0.8;
                font-weight: 300;
            }
            
            .upload-section {
                background: white;
                padding: 2rem;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                margin-bottom: 2rem;
            }
            
            .file-upload {
                border: 2px dashed #ddd;
                border-radius: 8px;
                padding: 2rem;
                text-align: center;
                transition: all 0.3s ease;
                cursor: pointer;
            }
            
            .file-upload:hover {
                border-color: #667eea;
                background-color: #f8f9ff;
            }
            
            .file-upload.dragover {
                border-color: #667eea;
                background-color: #f0f2ff;
            }
            
            #fileInput {
                display: none;
            }
            
            .upload-text {
                font-size: 1.1rem;
                color: #666;
                margin-bottom: 1rem;
            }
            
            .file-types {
                font-size: 0.9rem;
                color: #999;
            }
            
            .analyze-btn {
                width: 100%;
                padding: 1rem 2rem;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 1.1rem;
                font-weight: 600;
                cursor: pointer;
                transition: transform 0.2s ease;
                margin-top: 1rem;
            }
            
            .analyze-btn:hover {
                transform: translateY(-2px);
            }
            
            .analyze-btn:disabled {
                opacity: 0.6;
                cursor: not-allowed;
                transform: none;
            }
            
            .results-section {
                background: white;
                padding: 2rem;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                display: none;
            }
            
            .score-circle {
                width: 120px;
                height: 120px;
                border-radius: 50%;
                margin: 0 auto 2rem;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 2rem;
                font-weight: bold;
                color: white;
            }
            
            .score-excellent { background: linear-gradient(135deg, #4CAF50, #45a049); }
            .score-good { background: linear-gradient(135deg, #2196F3, #1976D2); }
            .score-fair { background: linear-gradient(135deg, #FF9800, #F57C00); }
            .score-poor { background: linear-gradient(135deg, #f44336, #d32f2f); }
            
            .issues-list {
                list-style: none;
                margin: 1rem 0;
            }
            
            .issues-list li {
                padding: 0.8rem;
                background: #f8f9fa;
                border-left: 4px solid #ff6b6b;
                margin-bottom: 0.5rem;
                border-radius: 4px;
            }
            
            .upgrade-section {
                background: linear-gradient(135deg, #ff6b6b, #ee5a52);
                color: white;
                padding: 2rem;
                border-radius: 12px;
                text-align: center;
                margin-top: 2rem;
            }
            
            .upgrade-btn {
                background: white;
                color: #ff6b6b;
                padding: 1rem 2rem;
                border: none;
                border-radius: 8px;
                font-size: 1.1rem;
                font-weight: 600;
                cursor: pointer;
                text-decoration: none;
                display: inline-block;
                transition: transform 0.2s ease;
                margin-top: 1rem;
            }
            
            .upgrade-btn:hover {
                transform: translateY(-2px);
            }
            
            .loading {
                text-align: center;
                padding: 2rem;
            }
            
            .spinner {
                border: 3px solid #f3f3f3;
                border-top: 3px solid #667eea;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                animation: spin 1s linear infinite;
                margin: 0 auto 1rem;
            }
            
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            
            .detailed-results {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 2rem;
                margin: 2rem 0;
            }
            
            .metric-card {
                background: #f8f9fa;
                padding: 1.5rem;
                border-radius: 8px;
                border-left: 4px solid #667eea;
            }
            
            .metric-score {
                font-size: 2rem;
                font-weight: bold;
                color: #667eea;
                margin-bottom: 0.5rem;
            }
            
            .recommendations {
                background: #e8f5e8;
                padding: 1.5rem;
                border-radius: 8px;
                border-left: 4px solid #4CAF50;
                margin: 2rem 0;
            }
            
            .recommendations h3 {
                color: #2e7d32;
                margin-bottom: 1rem;
            }
            
            .recommendations ol {
                margin-left: 1rem;
            }
            
            .recommendations li {
                margin-bottom: 0.5rem;
                line-height: 1.5;
            }
            
            .testimonials {
                background: white;
                padding: 2rem;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                margin-bottom: 2rem;
            }
            
            .testimonials h2 {
                text-align: center;
                color: #333;
                margin-bottom: 2rem;
                font-size: 1.8rem;
            }
            
            .testimonial-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 1.5rem;
            }
            
            .testimonial {
                background: #f8f9fa;
                padding: 1.5rem;
                border-radius: 8px;
                border-left: 4px solid #667eea;
                position: relative;
            }
            
            .testimonial-quote {
                font-style: italic;
                margin-bottom: 1rem;
                color: #555;
                line-height: 1.6;
            }
            
            .testimonial-author {
                font-weight: 600;
                color: #333;
                font-size: 0.9rem;
            }
            
            .testimonial-role {
                color: #666;
                font-size: 0.8rem;
            }
            
            .footer {
                background: rgba(255,255,255,0.1);
                color: white;
                text-align: center;
                padding: 2rem;
                border-radius: 12px;
                margin-top: 3rem;
            }
            
            .footer h3 {
                margin-bottom: 1rem;
                font-size: 1.2rem;
            }
            
            .footer p {
                opacity: 0.9;
                margin-bottom: 0.5rem;
            }
            
            .footer a {
                color: #b3d9ff;
                text-decoration: none;
            }
            
            .footer a:hover {
                text-decoration: underline;
            }
            
            .pricing-banner {
                background: linear-gradient(135deg, #ff6b6b, #ee5a52);
                color: white;
                padding: 1rem;
                border-radius: 8px;
                text-align: center;
                margin: 1rem 0;
                font-weight: 600;
            }
            
            .dynamic-price {
                font-size: 1.2rem;
                color: #fff;
            }
            
            .job-posting-section {
                margin-top: 1.5rem;
            }
            
            .job-posting-label {
                font-size: 1rem;
                font-weight: 600;
                color: #333;
                margin-bottom: 0.5rem;
            }
            
            .job-posting-subtitle {
                font-size: 0.9rem;
                color: #666;
                margin-bottom: 1rem;
            }
            
            .job-posting-textarea {
                width: 100%;
                min-height: 120px;
                padding: 1rem;
                border: 2px solid #ddd;
                border-radius: 8px;
                font-size: 0.95rem;
                font-family: inherit;
                resize: vertical;
                transition: border-color 0.3s ease;
            }
            
            .job-posting-textarea:focus {
                outline: none;
                border-color: #667eea;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }
            
            .job-posting-textarea::placeholder {
                color: #999;
                font-style: italic;
            }
            
            /* Product Selection Styles */
            .product-selection-section {
                background: white;
                padding: 2rem;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                margin-bottom: 2rem;
            }
            
            .section-header {
                text-align: center;
                margin-bottom: 2rem;
            }
            
            .section-header h2 {
                color: #333;
                font-size: 1.8rem;
                margin-bottom: 0.5rem;
            }
            
            .section-header p {
                color: #666;
                font-size: 1rem;
            }
            
            .products-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1.5rem;
                margin-bottom: 2rem;
            }
            
            .product-card {
                border: 2px solid #e1e8ed;
                border-radius: 12px;
                padding: 1.5rem;
                text-align: center;
                cursor: pointer;
                transition: all 0.3s ease;
                position: relative;
                background: #fafbfc;
            }
            
            .product-card:hover {
                border-color: #667eea;
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
            }
            
            .product-card.selected {
                border-color: #667eea;
                background: linear-gradient(135deg, #667eea15, #764ba215);
                transform: translateY(-2px);
            }
            
            .product-emoji {
                font-size: 2.5rem;
                margin-bottom: 0.5rem;
                display: block;
            }
            
            .product-name {
                font-size: 1.2rem;
                font-weight: 700;
                color: #333;
                margin-bottom: 0.5rem;
            }
            
            .product-description {
                color: #666;
                font-size: 0.9rem;
                margin-bottom: 1rem;
                line-height: 1.4;
            }
            
            .product-benefits {
                text-align: left;
                margin-bottom: 1rem;
            }
            
            .product-benefits ul {
                list-style: none;
                padding: 0;
            }
            
            .product-benefits li {
                color: #555;
                font-size: 0.85rem;
                margin-bottom: 0.3rem;
                padding-left: 1rem;
                position: relative;
            }
            
            .product-benefits li:before {
                content: "‚úì";
                color: #4caf50;
                font-weight: bold;
                position: absolute;
                left: 0;
            }
            
            .product-price {
                font-size: 1.4rem;
                font-weight: 700;
                color: #667eea;
                margin-bottom: 0.5rem;
            }
            
            .product-time {
                color: #888;
                font-size: 0.8rem;
            }
            
            .bundle-section {
                border-top: 2px solid #e1e8ed;
                padding-top: 2rem;
                margin-top: 2rem;
            }
            
            .bundle-header {
                text-align: center;
                margin-bottom: 2rem;
            }
            
            .bundle-header h3 {
                color: #333;
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }
            
            .bundle-header p {
                color: #666;
                font-size: 0.95rem;
            }
            
            .bundles-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 1.5rem;
            }
            
            .bundle-card {
                border: 2px solid #ff6b6b;
                border-radius: 12px;
                padding: 1.5rem;
                text-align: center;
                cursor: pointer;
                transition: all 0.3s ease;
                position: relative;
                background: linear-gradient(135deg, #ff6b6b15, #ee5a5215);
            }
            
            .bundle-card:hover {
                border-color: #ff5252;
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(255, 107, 107, 0.2);
            }
            
            .bundle-card.selected {
                border-color: #ff5252;
                background: linear-gradient(135deg, #ff6b6b25, #ee5a5225);
                transform: translateY(-2px);
            }
            
            .bundle-badge {
                position: absolute;
                top: -8px;
                right: -8px;
                background: #ff6b6b;
                color: white;
                padding: 0.3rem 0.6rem;
                border-radius: 12px;
                font-size: 0.7rem;
                font-weight: 700;
                text-transform: uppercase;
            }
            
            .bundle-badge.best-value {
                background: #4caf50;
            }
            
            .bundle-name {
                font-size: 1.3rem;
                font-weight: 700;
                color: #333;
                margin-bottom: 0.5rem;
            }
            
            .bundle-description {
                color: #666;
                font-size: 0.9rem;
                margin-bottom: 1rem;
            }
            
            .bundle-includes {
                text-align: left;
                margin-bottom: 1rem;
            }
            
            .bundle-includes h4 {
                font-size: 0.9rem;
                color: #333;
                margin-bottom: 0.5rem;
                font-weight: 600;
            }
            
            .bundle-includes ul {
                list-style: none;
                padding: 0;
            }
            
            .bundle-includes li {
                color: #555;
                font-size: 0.85rem;
                margin-bottom: 0.3rem;
                padding-left: 1rem;
                position: relative;
            }
            
            .bundle-includes li:before {
                content: "üìã";
                position: absolute;
                left: 0;
                font-size: 0.8rem;
            }
            
            .bundle-pricing {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 1rem;
                margin-bottom: 0.5rem;
            }
            
            .bundle-original-price {
                color: #888;
                text-decoration: line-through;
                font-size: 1rem;
            }
            
            .bundle-price {
                font-size: 1.6rem;
                font-weight: 700;
                color: #ff6b6b;
            }
            
            .bundle-savings {
                background: #4caf50;
                color: white;
                padding: 0.2rem 0.5rem;
                border-radius: 6px;
                font-size: 0.8rem;
                font-weight: 600;
            }
            
            .selected-product {
                background: #f8f9fa;
                border: 2px solid #667eea;
                border-radius: 12px;
                padding: 1.5rem;
                text-align: center;
                margin-top: 2rem;
            }
            
            .selection-summary h3 {
                color: #333;
                margin-bottom: 1rem;
            }
            
            .selected-item {
                background: white;
                border-radius: 8px;
                padding: 1rem;
                margin-bottom: 1.5rem;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }
            
            .continue-btn {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                padding: 1rem 2rem;
                border-radius: 8px;
                font-size: 1.1rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .continue-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            }
            
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Resume Health Checker</h1>
                <p>Get expert feedback to land more interviews</p>
                <p class="subtitle">AI-powered analysis used by 1000+ job seekers worldwide</p>
            </div>
            
            <div class="testimonials">
                <h2>Success Stories</h2>
                <div class="testimonial-grid">
                    <div class="testimonial">
                        <div class="testimonial-quote">
                            "The detailed analysis helped me identify exactly why my resume wasn't getting responses. After implementing the suggested changes, I got 3 interview requests within two weeks!"
                        </div>
                        <div class="testimonial-author">Sarah M.</div>
                        <div class="testimonial-role">Marketing Manager, Tech Startup</div>
                    </div>
                    
                    <div class="testimonial">
                        <div class="testimonial-quote">
                            "The text rewrites were game-changing. I had no idea my bullet points were so generic. The improved versions with metrics made my achievements stand out immediately."
                        </div>
                        <div class="testimonial-author">David K.</div>
                        <div class="testimonial-role">Software Engineer, FAANG</div>
                    </div>
                    
                    <div class="testimonial">
                        <div class="testimonial-quote">
                            "Worth every penny! The ATS optimization tips helped my resume pass through automated screening. I went from 0 callbacks to landing my dream job in consulting."
                        </div>
                        <div class="testimonial-author">Maria R.</div>
                        <div class="testimonial-role">Business Consultant, Fortune 500</div>
                    </div>
                </div>
            </div>
            
            <!-- Product Selection Section -->
            <div class="product-selection-section" id="productSelection" style="display: none;">
                <div class="section-header">
                    <h2>üöÄ Choose Your Career Transformation</h2>
                    <p>Select what you need to land your dream job faster</p>
                </div>
                
                <div class="products-grid" id="productsGrid">
                    <!-- Products will be loaded dynamically -->
                </div>
                
                <div class="bundle-section" id="bundleSection" style="display: none;">
                    <div class="bundle-header">
                        <h3>üí° Smart Recommendations</h3>
                        <p>Save money and get everything you need for job search success</p>
                    </div>
                    <div class="bundles-grid" id="bundlesGrid">
                        <!-- Bundles will be loaded dynamically -->
                    </div>
                </div>
                
                <div class="selected-product" id="selectedProduct" style="display: none;">
                    <div class="selection-summary">
                        <h3>Your Selection:</h3>
                        <div class="selected-item" id="selectedItem"></div>
                        <button class="continue-btn" onclick="showUploadSection()">
                            Continue to Upload Resume üìã
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="upload-section" id="uploadSection">
                <div class="file-upload" onclick="document.getElementById('fileInput').click()">
                    <input type="file" id="fileInput" accept=".pdf,.docx" onchange="handleFileSelect(event)">
                    <div class="upload-text">
                        <strong>Click to upload your resume</strong><br>
                        or drag and drop it here
                    </div>
                    <div class="file-types">Supports PDF and Word documents</div>
                </div>
                
                <div class="job-posting-section">
                    <div class="job-posting-label">üíº Job Posting (Optional)</div>
                    <div class="job-posting-subtitle">Paste job posting here for role-specific insights</div>
                    <textarea 
                        id="jobPostingText" 
                        class="job-posting-textarea" 
                        placeholder="Paste the job posting or job description here to get personalized analysis for this specific role...

Example: We are looking for a Senior Software Engineer with 5+ years experience in Python, React, and AWS..."
                        oninput="updateAnalyzeButton()"
                    ></textarea>
                </div>
                
                <button class="analyze-btn" id="analyzeBtn" onclick="analyzeResume()" disabled>
                    Analyze My Resume - FREE
                </button>
            </div>
            
            <div class="results-section" id="resultsSection">
                <!-- Results will be displayed here -->
            </div>
            
            <div class="footer">
                <h3>Need Help?</h3>
                <p>Our team is here to support your career success</p>
                <p>Contact us: <a href="mailto:support@idpetech.com">support@idpetech.com</a></p>
                <p style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.7;">
                    Trusted by professionals worldwide ‚Ä¢ Secure payment processing ‚Ä¢ 24/7 support
                </p>
            </div>
        </div>

        <script>
            console.log('üü¢ JavaScript starting...');
            
            // WORKING STATIC PRODUCT CARDS - No API calls needed
            setTimeout(function() {
                console.log('üé® Loading static product cards...');
                const productsGrid = document.getElementById('productsGrid');
                if (productsGrid) {
                    productsGrid.innerHTML = `
                        <div class="product-card" onclick="selectProduct('individual', 'resume_analysis', '$5')" style="border: 2px solid #e1e8ed; border-radius: 12px; padding: 1.5rem; text-align: center; cursor: pointer; transition: all 0.3s ease; background: #fafbfc;">
                            <span style="font-size: 2.5rem; display: block; margin-bottom: 0.5rem;">üìã</span>
                            <div style="font-size: 1.2rem; font-weight: 700; color: #333; margin-bottom: 0.5rem;">Resume Health Check</div>
                            <div style="color: #666; font-size: 0.9rem; margin-bottom: 1rem; line-height: 1.4;">Transform your resume into an interview magnet</div>
                            <div style="text-align: left; margin-bottom: 1rem;">
                                <ul style="list-style: none; padding: 0;">
                                    <li style="color: #555; font-size: 0.85rem; margin-bottom: 0.3rem; padding-left: 1rem; position: relative;"><span style="content: '‚úì'; color: #4caf50; font-weight: bold; position: absolute; left: 0;">‚úì</span>ATS optimization insights</li>
                                    <li style="color: #555; font-size: 0.85rem; margin-bottom: 0.3rem; padding-left: 1rem; position: relative;"><span style="content: '‚úì'; color: #4caf50; font-weight: bold; position: absolute; left: 0;">‚úì</span>Content enhancement suggestions</li>
                                    <li style="color: #555; font-size: 0.85rem; margin-bottom: 0.3rem; padding-left: 1rem; position: relative;"><span style="content: '‚úì'; color: #4caf50; font-weight: bold; position: absolute; left: 0;">‚úì</span>Impact metrics improvements</li>
                                </ul>
                            </div>
                            <div style="font-size: 1.4rem; font-weight: 700; color: #667eea; margin-bottom: 0.5rem;">$5</div>
                            <div style="color: #888; font-size: 0.8rem;">2-3 minutes</div>
                        </div>
                        
                        <div class="product-card" onclick="selectProduct('individual', 'job_fit_analysis', '$6')" style="border: 2px solid #e1e8ed; border-radius: 12px; padding: 1.5rem; text-align: center; cursor: pointer; transition: all 0.3s ease; background: #fafbfc;">
                            <span style="font-size: 2.5rem; display: block; margin-bottom: 0.5rem;">üéØ</span>
                            <div style="font-size: 1.2rem; font-weight: 700; color: #333; margin-bottom: 0.5rem;">Job Fit Analysis</div>
                            <div style="color: #666; font-size: 0.9rem; margin-bottom: 1rem; line-height: 1.4;">Position yourself as the perfect candidate</div>
                            <div style="text-align: left; margin-bottom: 1rem;">
                                <ul style="list-style: none; padding: 0;">
                                    <li style="color: #555; font-size: 0.85rem; margin-bottom: 0.3rem; padding-left: 1rem; position: relative;"><span style="content: '‚úì'; color: #4caf50; font-weight: bold; position: absolute; left: 0;">‚úì</span>Job-specific optimization</li>
                                    <li style="color: #555; font-size: 0.85rem; margin-bottom: 0.3rem; padding-left: 1rem; position: relative;"><span style="content: '‚úì'; color: #4caf50; font-weight: bold; position: absolute; left: 0;">‚úì</span>Missing requirements identification</li>
                                    <li style="color: #555; font-size: 0.85rem; margin-bottom: 0.3rem; padding-left: 1rem; position: relative;"><span style="content: '‚úì'; color: #4caf50; font-weight: bold; position: absolute; left: 0;">‚úì</span>Strategic positioning advice</li>
                                </ul>
                            </div>
                            <div style="font-size: 1.4rem; font-weight: 700; color: #667eea; margin-bottom: 0.5rem;">$6</div>
                            <div style="color: #888; font-size: 0.8rem;">3-4 minutes</div>
                        </div>
                        
                        <div class="product-card" onclick="selectProduct('individual', 'cover_letter', '$4')" style="border: 2px solid #e1e8ed; border-radius: 12px; padding: 1.5rem; text-align: center; cursor: pointer; transition: all 0.3s ease; background: #fafbfc;">
                            <span style="font-size: 2.5rem; display: block; margin-bottom: 0.5rem;">‚úçÔ∏è</span>
                            <div style="font-size: 1.2rem; font-weight: 700; color: #333; margin-bottom: 0.5rem;">Cover Letter Generator</div>
                            <div style="color: #666; font-size: 0.9rem; margin-bottom: 1rem; line-height: 1.4;">Write cover letters that open doors</div>
                            <div style="text-align: left; margin-bottom: 1rem;">
                                <ul style="list-style: none; padding: 0;">
                                    <li style="color: #555; font-size: 0.85rem; margin-bottom: 0.3rem; padding-left: 1rem; position: relative;"><span style="content: '‚úì'; color: #4caf50; font-weight: bold; position: absolute; left: 0;">‚úì</span>Personalized for each role</li>
                                    <li style="color: #555; font-size: 0.85rem; margin-bottom: 0.3rem; padding-left: 1rem; position: relative;"><span style="content: '‚úì'; color: #4caf50; font-weight: bold; position: absolute; left: 0;">‚úì</span>Strategic storytelling</li>
                                    <li style="color: #555; font-size: 0.85rem; margin-bottom: 0.3rem; padding-left: 1rem; position: relative;"><span style="content: '‚úì'; color: #4caf50; font-weight: bold; position: absolute; left: 0;">‚úì</span>Company research integration</li>
                                </ul>
                            </div>
                            <div style="font-size: 1.4rem; font-weight: 700; color: #667eea; margin-bottom: 0.5rem;">$4</div>
                            <div style="color: #888; font-size: 0.8rem;">2-3 minutes</div>
                        </div>
                        
                        <div class="product-card" onclick="showBundles()" style="border: 2px solid #ff6b6b; border-radius: 12px; padding: 1.5rem; text-align: center; cursor: pointer; transition: all 0.3s ease; background: linear-gradient(135deg, #ff6b6b15, #4caf5015);">
                            <span style="font-size: 2.5rem; display: block; margin-bottom: 0.5rem;">üéØ</span>
                            <div style="font-size: 1.2rem; font-weight: 700; color: #333; margin-bottom: 0.5rem;">Bundle & Save</div>
                            <div style="color: #666; font-size: 0.9rem; margin-bottom: 1rem; line-height: 1.4;">Get multiple services and save up to 27%</div>
                            <div style="text-align: left; margin-bottom: 1rem;">
                                <ul style="list-style: none; padding: 0;">
                                    <li style="color: #555; font-size: 0.85rem; margin-bottom: 0.3rem; padding-left: 1rem; position: relative;"><span style="content: '‚úì'; color: #4caf50; font-weight: bold; position: absolute; left: 0;">‚úì</span>Complete job search toolkit</li>
                                    <li style="color: #555; font-size: 0.85rem; margin-bottom: 0.3rem; padding-left: 1rem; position: relative;"><span style="content: '‚úì'; color: #4caf50; font-weight: bold; position: absolute; left: 0;">‚úì</span>Save $3-$8 on bundles</li>
                                    <li style="color: #555; font-size: 0.85rem; margin-bottom: 0.3rem; padding-left: 1rem; position: relative;"><span style="content: '‚úì'; color: #4caf50; font-weight: bold; position: absolute; left: 0;">‚úì</span>Priority processing</li>
                                </ul>
                            </div>
                            <div style="font-size: 1.4rem; font-weight: 700; color: #ff6b6b; margin-bottom: 0.5rem;">View Bundles</div>
                            <div style="color: #888; font-size: 0.8rem;">Best Value!</div>
                        </div>
                    `;
                    console.log('‚úÖ Static product cards loaded successfully!');
                } else {
                    console.error('‚ùå Could not find productsGrid element');
                }
            }, 100);
            
            // Product selection function
            function selectProduct(productType, productId, displayPrice) {
                console.log('üéØ Product selected:', productType, productId, displayPrice);
                
                // Check if user has uploaded a file
                if (!selectedFile) {
                    alert('Please upload your resume first before selecting a service.');
                    document.getElementById('fileInput').focus();
                    return;
                }
                
                selectedProductType = productType;
                selectedProductId = productId;
                
                // Show confirmation and proceed to payment
                const productNames = {
                    'resume_analysis': 'Resume Health Check',
                    'job_fit_analysis': 'Job Fit Analysis', 
                    'cover_letter': 'Cover Letter Generator'
                };
                
                const productName = productNames[productId] || productId;
                if (confirm(`Ready to proceed with ${productName} for ${displayPrice}?`)) {
                    proceedToPayment(productType, productId);
                }
            }
            
            // Bundle selection function
            function showBundles() {
                if (!selectedFile) {
                    alert('Please upload your resume first before selecting bundle options.');
                    document.getElementById('fileInput').focus();
                    return;
                }
                
                const bundleOptions = `
Choose your bundle option:

1. Complete Package - $11 (Save $4)
   Resume + Job Fit + Cover Letter

2. Career Boost - $9 (Save $2)  
   Resume + Job Fit Analysis

3. Job Hunter - $7 (Save $2)
   Resume + Cover Letter

Which would you like? (Enter 1, 2, or 3)
                `;
                
                const choice = prompt(bundleOptions);
                
                if (choice === '1') {
                    selectProduct('bundle', 'complete_package', '$11');
                } else if (choice === '2') {
                    selectProduct('bundle', 'career_boost', '$9');
                } else if (choice === '3') {
                    selectProduct('bundle', 'job_hunter', '$7');
                } else if (choice !== null) {
                    alert('Please enter 1, 2, or 3 to select a bundle option.');
                }
            }
            
            // Main payment function for product selections
            async function proceedToPayment(productType, productId) {
                if (!selectedFile) {
                    alert('Please upload your resume first.');
                    return;
                }
                
                console.log('üí≥ Creating payment session for:', productType, productId);
                
                try {
                    // Create form data for payment session
                    const formData = new FormData();
                    formData.append('product_type', productType);
                    formData.append('product_id', productId);
                    
                    // Prepare session data
                    const sessionData = {
                        resume_text: 'Placeholder resume text', // Will be populated from file
                        session_id: crypto.randomUUID(),
                        user_region: 'US', // TODO: Get from geolocation
                        selected_product: `${productType}_${productId}`
                    };
                    formData.append('session_data', JSON.stringify(sessionData));
                    
                    // Show loading indicator
                    const loadingMessage = document.createElement('div');
                    loadingMessage.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">Creating payment session...</div>';
                    document.body.appendChild(loadingMessage);
                    
                    // Create payment session with the API
                    const response = await fetch('/api/create-payment-session', {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const paymentSession = await response.json();
                    console.log('‚úÖ Payment session created:', paymentSession);
                    
                    // Store file data with unique session ID
                    const sessionId = paymentSession.payment_session_id;
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const fileData = {
                            name: selectedFile.name,
                            type: selectedFile.type,
                            content: e.target.result,
                            timestamp: Date.now(),
                            product_type: productType,
                            product_id: productId
                        };
                        
                        // Store file data with session ID
                        const storageKey = `resume_${sessionId}`;
                        const metadataKey = `metadata_${sessionId}`;
                        
                        localStorage.setItem(storageKey, JSON.stringify(fileData));
                        
                        // Store session metadata
                        const metadata = {
                            sessionId: sessionId,
                            timestamp: Date.now(),
                            fileName: fileData.name,
                            status: 'pending_payment',
                            product_type: productType,
                            product_id: productId
                        };
                        localStorage.setItem(metadataKey, JSON.stringify(metadata));
                        
                        // Store session ID in URL hash for retrieval after payment
                        window.location.hash = `session=${sessionId}`;
                        
                        console.log('üíæ Stored file with session:', sessionId);
                        
                        // Remove loading indicator
                        document.body.removeChild(loadingMessage);
                        
                        // Redirect to Stripe payment
                        console.log('üöÄ Redirecting to Stripe:', paymentSession.payment_url);
                        window.location.href = paymentSession.payment_url;
                    };
                    
                    reader.readAsDataURL(selectedFile);
                    
                } catch (error) {
                    console.error('‚ùå Payment session creation failed:', error);
                    alert('Unable to create payment session. Please try again.');
                    
                    // Remove loading indicator if it exists
                    const loadingMessage = document.querySelector('div[style*="Creating payment session"]');
                    if (loadingMessage && loadingMessage.parentNode) {
                        loadingMessage.parentNode.removeChild(loadingMessage);
                    }
                }
            }
            
            let selectedFile = null;
            let currentAnalysis = null;
            let currentPricing = { price: '$5', currency: 'USD', stripe_url: 'https://buy.stripe.com/dRm00i8lSfUy6CRaHOfMA01' };
            
            // Multi-product selection variables
            let multiProductPricing = null;
            let selectedProductType = null; // 'individual' or 'bundle'
            let selectedProductId = null;
            let showingBundles = false;

            // Load pricing configuration and detect user's country
            async function loadPricingConfig() {
                try {
                    const response = await fetch('/api/pricing-config');
                    const config = await response.json();
                    
                    // Check if we're in test mode
                    const urlParams = new URLSearchParams(window.location.search);
                    const testCountry = urlParams.get('test_country');
                    
                    let countryCode = 'US';
                    
                    if (testCountry) {
                        // Use test country from URL parameter
                        countryCode = testCountry.toUpperCase();
                        console.log('üß™ TEST MODE: Simulating country:', countryCode);
                    } else {
                        // Normal geolocation detection
                        try {
                            const geoResponse = await fetch('https://ipapi.co/json/');
                            const geoData = await geoResponse.json();
                            if (geoData.country_code) {
                                countryCode = geoData.country_code;
                            }
                            console.log('üåç Detected country:', countryCode);
                        } catch (e) {
                            console.log('IP geolocation failed, using default USD pricing');
                        }
                    }
                    
                    // Set pricing based on country
                    currentPricing = config.pricing[countryCode] || config.pricing.default;
                    console.log('üí∞ Using pricing:', currentPricing);
                    updatePricingDisplay();
                    
                } catch (error) {
                    console.log('Failed to load pricing config, using default');
                }
            }
            
            function updatePricingDisplay() {
                // Update price display elements
                const priceElements = document.querySelectorAll('.price-display');
                priceElements.forEach(el => {
                    el.textContent = currentPricing.price;
                });
                
                // Update any other dynamic price displays
                const dynamicPriceElements = document.querySelectorAll('.dynamic-price');
                dynamicPriceElements.forEach(el => {
                    el.textContent = currentPricing.price;
                });
            }

            // Function to find any pending payment sessions
            function findAnyPendingPayment() {
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('resume_meta_')) {
                        const metadata = JSON.parse(localStorage.getItem(key));
                        if (metadata.status === 'pending_payment') {
                            // Check if it's not too old (24 hours max)
                            const age = Date.now() - metadata.timestamp;
                            if (age < 24 * 60 * 60 * 1000) {
                                return metadata.sessionId;
                            }
                        }
                    }
                }
                return null;
            }

            // Function to clean up old sessions
            function cleanupOldSessions() {
                const maxAge = 24 * 60 * 60 * 1000; // 24 hours
                for (let i = localStorage.length - 1; i >= 0; i--) {
                    const key = localStorage.key(i);
                    if (key && (key.startsWith('resume_meta_') || key.startsWith('resume_session_'))) {
                        const item = localStorage.getItem(key);
                        try {
                            const data = JSON.parse(item);
                            if (data.timestamp && (Date.now() - data.timestamp > maxAge)) {
                                localStorage.removeItem(key);
                                console.log('üßπ Cleaned up old session:', key);
                            }
                        } catch (e) {
                            // Invalid JSON, remove it
                            localStorage.removeItem(key);
                        }
                    }
                }
            }

            // Clean up old sessions on page load
            cleanupOldSessions();

            // Check for payment success - multiple detection methods
            const urlParams = new URLSearchParams(window.location.search);
            const hashParams = new URLSearchParams(window.location.hash.substring(1));
            const sessionId = urlParams.get('client_reference_id') || hashParams.get('session');
            const paymentToken = urlParams.get('payment_token'); // Keep for backward compatibility
            
            // Detect payment return from multiple sources
            const isPaymentReturn = document.referrer.includes('stripe.com') || 
                                  sessionId || 
                                  paymentToken ||
                                  window.location.search.includes('payment') ||
                                  window.location.hash.includes('session=') ||
                                  findAnyPendingPayment();
            
            if (isPaymentReturn) {
                console.log('üéâ Payment return detected');
                
                // Try to find stored file data using multiple methods
                let savedFileData = null;
                let storageKey = null;
                let metadataKey = null;
                let activeSessionId = null;
                
                // Method 1: Direct session ID (from URL hash or parameters)
                if (sessionId) {
                    activeSessionId = sessionId;
                    storageKey = `resume_session_${sessionId}`;
                    metadataKey = `resume_meta_${sessionId}`;
                    savedFileData = localStorage.getItem(storageKey);
                    console.log('üìÅ Trying direct session:', sessionId);
                }
                
                // Method 2: Find any pending payment session
                if (!savedFileData) {
                    activeSessionId = findAnyPendingPayment();
                    if (activeSessionId) {
                        storageKey = `resume_session_${activeSessionId}`;
                        metadataKey = `resume_meta_${activeSessionId}`;
                        savedFileData = localStorage.getItem(storageKey);
                        console.log('üìÅ Trying pending payment session:', activeSessionId);
                    }
                }
                
                // Method 3: Legacy fallbacks
                if (!savedFileData) {
                    // Try old session format
                    const legacyKey = localStorage.getItem('latest_resume_key');
                    if (legacyKey) {
                        storageKey = legacyKey;
                        savedFileData = localStorage.getItem(legacyKey);
                        console.log('üìÅ Trying legacy latest key:', legacyKey);
                    }
                }
                
                if (!savedFileData && paymentToken) {
                    storageKey = 'pendingResumeUpload';
                    savedFileData = localStorage.getItem(storageKey);
                    console.log('üìÅ Trying legacy upload key');
                }
                
                console.log('üìÅ File data found:', savedFileData ? 'YES' : 'NO');
                
                if (savedFileData) {
                    const fileData = JSON.parse(savedFileData);
                    // Recreate file from stored data
                    fetch('data:' + fileData.type + ';base64,' + fileData.data)
                        .then(res => res.blob())
                        .then(blob => {
                            const file = new File([blob], fileData.name, { type: fileData.type });
                            selectedFile = file;
                            
                            // Clear the stored file data and metadata
                            if (storageKey) {
                                localStorage.removeItem(storageKey);
                            }
                            if (metadataKey) {
                                localStorage.removeItem(metadataKey);
                            }
                            // Clean up legacy trackers
                            localStorage.removeItem('latest_resume_key');
                            
                            // Clear URL hash if it contains session info
                            if (window.location.hash.includes('session=')) {
                                window.location.hash = '';
                            }
                            
                            // Update UI to show payment success
                            updateUploadUI(file.name, true);
                            
                            // Force immediate paid analysis
                            setTimeout(() => {
                                console.log('üîÑ Starting automatic paid analysis...');
                                analyzeResume();
                            }, 100);
                        });
                } else {
                    console.log('‚ö†Ô∏è Payment return detected but no file data found');
                }
            }

            // Handle file upload
            function handleFileSelect(event) {
                const file = event.target.files[0];
                if (file) {
                    selectedFile = file;
                    updateAnalyzeButton();
                    
                    // Clean up any lingering payment sessions to prevent premium leakage
                    cleanupOldSessions();
                    
                    // Update upload UI to show selected file
                    updateUploadUI(file.name, false);
                    
                    // Show product selection options after file upload
                    showProductOptions();
                }
            }
            
            // Show free analysis option after file upload
            function showProductOptions() {
                console.log('üìã File uploaded successfully, showing analysis options...');
                
                // Change the analyze button to be more prominent and start free analysis
                const analyzeBtn = document.getElementById('analyzeBtn');
                if (analyzeBtn) {
                    analyzeBtn.style.display = 'block';
                    analyzeBtn.innerHTML = 'üéØ Get Your FREE Resume Analysis';
                    analyzeBtn.classList.add('pulse');
                    
                    // Scroll to the analyze button for clear next step
                    analyzeBtn.scrollIntoView({ 
                        behavior: 'smooth',
                        block: 'center'
                    });
                }
                
                console.log('‚úÖ Free analysis option highlighted');
            }

            function updateAnalyzeButton() {
                const analyzeBtn = document.getElementById('analyzeBtn');
                const jobPostingText = document.getElementById('jobPostingText').value.trim();
                
                if (selectedFile) {
                    analyzeBtn.disabled = false;
                    if (jobPostingText) {
                        analyzeBtn.textContent = 'Analyze Resume + Job Fit - FREE';
                    } else {
                        analyzeBtn.textContent = 'Analyze My Resume - FREE';
                    }
                } else {
                    analyzeBtn.disabled = true;
                    analyzeBtn.textContent = 'Analyze My Resume - FREE';
                }
            }

            // Centralized function to update upload UI while preserving functionality
            function updateUploadUI(fileName, isPaidAnalysis = false) {
                const uploadDiv = document.querySelector('.file-upload');
                const statusText = isPaidAnalysis ? 
                    `<strong>Payment successful! Analyzing: ${fileName}</strong><br><small>Getting your detailed analysis...</small>` :
                    `<strong>Selected: ${fileName}</strong><br><small>Click to change file</small>`;
                    
                uploadDiv.innerHTML = `
                    <input type="file" id="fileInput" accept=".pdf,.docx" onchange="handleFileSelect(event)" style="display: none;">
                    <div class="upload-text">
                        ${statusText}
                    </div>
                `;
                
                // Re-add click handler to maintain upload functionality
                uploadDiv.onclick = function() {
                    document.getElementById('fileInput').click();
                };
            }


            async function analyzeResume() {
                if (!selectedFile) {
                    alert('Please select a file first');
                    return;
                }

                const resultsSection = document.getElementById('resultsSection');
                resultsSection.style.display = 'block';
                resultsSection.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <p id="loadingMessage">Analyzing your resume...</p>
                        <p id="retryMessage" style="font-size: 0.9rem; color: #666; margin-top: 1rem; display: none;">
                            For users with slower connections, this may take up to 3 minutes...
                        </p>
                    </div>
                `;
                
                // Show retry message after 10 seconds for slow connections
                setTimeout(() => {
                    const retryMsg = document.getElementById('retryMessage');
                    if (retryMsg) {
                        retryMsg.style.display = 'block';
                    }
                }, 10000);

                const formData = new FormData();
                formData.append('file', selectedFile);
                
                // Add job posting if provided
                const jobPostingText = document.getElementById('jobPostingText').value.trim();
                if (jobPostingText) {
                    formData.append('job_posting', jobPostingText);
                    console.log('üìã Job posting included in analysis');
                }
                
                // Check for valid payment
                const urlParams = new URLSearchParams(window.location.search);
                const sessionId = urlParams.get('client_reference_id');
                const paymentToken = urlParams.get('payment_token');
                
                // Determine if this is a paid analysis - ONLY check URL parameters, not localStorage
                const isPaidAnalysis = sessionId || 
                                     paymentToken || 
                                     document.referrer.includes('stripe.com') ||
                                     window.location.hash.includes('session=');
                
                if (isPaidAnalysis) {
                    console.log('üí∞ Detected paid analysis - sending session_validated token');
                    formData.append('payment_token', 'session_validated');
                } else {
                    console.log('üÜì Free analysis');
                }

                try {
                    const response = await fetch('/api/check-resume', {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const analysis = await response.json();
                    currentAnalysis = analysis;
                    
                    // DEBUG: Log the full analysis to browser console
                    console.log('=== FULL ANALYSIS RESPONSE ===');
                    console.log('üìä Analysis type:', analysis.analysis_type);
                    console.log('üí∞ Is paid analysis:', analysis.analysis_type === 'paid');
                    console.log(analysis);
                    console.log('================================');
                    
                    displayResults(analysis);

                } catch (error) {
                    // Clear payment parameters from URL to prevent premium leakage on retry
                    const url = new URL(window.location);
                    url.searchParams.delete('payment_token');
                    url.searchParams.delete('client_reference_id');
                    if (window.location.hash.includes('session=')) {
                        window.location.hash = '';
                    }
                    window.history.replaceState({}, document.title, url);
                    
                    console.log('‚ùå Analysis error:', error);
                    
                    // Parse error response to get server message
                    let errorMessage = "Something went wrong. Please try again.";
                    let errorTitle = "Analysis Failed";
                    let helpText = "Please check your internet connection and try again.";
                    
                    try {
                        if (error.response && error.response.status === 503) {
                            errorTitle = "Service Temporarily Busy";
                            // Try to get the detailed error message from the server
                            const errorData = await error.response.json();
                            if (errorData.detail) {
                                errorMessage = errorData.detail;
                                if (errorMessage.includes("timeout") || errorMessage.includes("slow")) {
                                    helpText = "Your connection appears slow. The analysis will retry automatically with a longer timeout.";
                                } else if (errorMessage.includes("overloaded")) {
                                    helpText = "Our AI service is experiencing high demand. Please wait a few minutes before trying again.";
                                }
                            }
                        } else if (error.response && error.response.status >= 500) {
                            errorTitle = "Server Error";
                            errorMessage = "Our servers are experiencing issues. Please try again in a moment.";
                        } else if (!navigator.onLine) {
                            errorTitle = "No Internet Connection";
                            errorMessage = "Please check your internet connection and try again.";
                            helpText = "Make sure you're connected to the internet.";
                        }
                    } catch (e) {
                        console.log('Error parsing error response:', e);
                    }
                    
                    resultsSection.innerHTML = `
                        <div style="background: #fff5f5; border: 1px solid #feb2b2; border-radius: 8px; padding: 2rem; text-align: center;">
                            <div style="color: #c53030; font-size: 2rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                            <h3 style="color: #c53030; margin-bottom: 1rem;">${errorTitle}</h3>
                            <p style="color: #4a5568; margin-bottom: 1rem; font-size: 1.1rem;">${errorMessage}</p>
                            <p style="color: #718096; font-size: 0.9rem; margin-bottom: 1.5rem;">${helpText}</p>
                            <button 
                                onclick="analyzeResume()" 
                                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 0.8rem 2rem; border: none; border-radius: 6px; font-size: 1rem; cursor: pointer; transition: transform 0.2s ease;"
                                onmouseover="this.style.transform='translateY(-1px)'"
                                onmouseout="this.style.transform='translateY(0px)'"
                            >
                                Try Again
                            </button>
                        </div>
                    `;
                }
            }

            function displayResults(analysis) {
                const resultsSection = document.getElementById('resultsSection');
                
                // Determine if this is job matching analysis
                const isJobMatching = 'job_fit_score' in analysis;
                const score = parseInt(isJobMatching ? analysis.job_fit_score : analysis.overall_score);
                const scoreClass = getScoreClass(score);

                // Debug logging
                console.log('Analysis type:', analysis.analysis_type);
                console.log('Is job matching:', isJobMatching);
                console.log('Has text_rewrites:', 'text_rewrites' in analysis);
                console.log('Has sample_improvements:', 'sample_improvements' in analysis);
                if (analysis.text_rewrites) {
                    console.log('Number of rewrites:', analysis.text_rewrites.length);
                }

                if (analysis.analysis_type === 'free') {
                    if (isJobMatching) {
                        // Display job matching free analysis
                        resultsSection.innerHTML = `
                            <div style="text-align: center;">
                                <div class="score-circle ${scoreClass}">
                                    ${score}%
                                </div>
                                <h2>Job Fit Score</h2>
                                <p style="margin: 1rem 0; color: #666;">Your resume's match for this specific job:</p>
                            </div>
                            
                            <div style="margin: 2rem 0;">
                                <h3 style="color: #ff6b6b; margin-bottom: 1rem;">Missing Requirements:</h3>
                                <ul class="issues-list">
                                    ${analysis.missing_requirements.map(req => `<li>${req}</li>`).join('')}
                                </ul>
                            </div>

                            <div class="upgrade-section">
                                <h3>Want Job-Specific Optimization?</h3>
                                <p>${analysis.upgrade_message}</p>
                                <p style="margin: 1rem 0;">Get job-specific improvements:</p>
                                <ul style="text-align: left; max-width: 400px; margin: 1rem auto;">
                                    <li>‚úì Keywords to add for this role</li>
                                    <li>‚úì Experience highlights to emphasize</li>
                                    <li>‚úì Tailored text rewrites</li>
                                    <li>‚úì Competitive advantages for this job</li>
                                    <li>‚úì Ready-to-use optimized content</li>
                                </ul>
                                <a href="#" class="upgrade-btn" onclick="showProductSelectionAfterFree()">
                                    üöÄ Choose Your Premium Analysis
                                </a>
                            </div>
                        `;
                        
                        // Add sentiment tracking
                        resultsSection.innerHTML += addSentimentTracking(analysis);
                    } else {
                        // Display regular free analysis
                        resultsSection.innerHTML = `
                            <div style="text-align: center;">
                                <div class="score-circle ${scoreClass}">
                                    ${score}/100
                                </div>
                                <h2>Your Resume Health Score</h2>
                                <p style="margin: 1rem 0; color: #666;">Here are the major issues we found:</p>
                            </div>
                            
                            <div style="margin: 2rem 0;">
                                <h3 style="color: #ff6b6b; margin-bottom: 1rem;">Major Issues Found:</h3>
                                <ul class="issues-list">
                                    ${analysis.major_issues.map(issue => `<li>${issue}</li>`).join('')}
                                </ul>
                            </div>

                            <div class="upgrade-section">
                                <h3>Want the Complete Analysis?</h3>
                                <p>${analysis.teaser_message}</p>
                                <p style="margin: 1rem 0;">Get detailed feedback on:</p>
                                <ul style="text-align: left; max-width: 400px; margin: 1rem auto;">
                                    <li>‚úì ATS optimization recommendations</li>
                                    <li>‚úì Content clarity improvements</li>
                                    <li>‚úì Impact metrics suggestions</li>
                                    <li>‚úì Formatting fixes</li>
                                    <li>‚úì Prioritized action plan</li>
                                </ul>
                                <a href="#" class="upgrade-btn" onclick="showProductSelectionAfterFree()">
                                    üöÄ Choose Your Premium Analysis
                                </a>
                            </div>
                        `;
                        
                        // Add sentiment tracking
                        resultsSection.innerHTML += addSentimentTracking(analysis);
                    }
                } else {
                    if (isJobMatching) {
                        // Display job matching paid analysis
                        resultsSection.innerHTML = `
                            <div style="text-align: center;">
                                <div class="score-circle ${scoreClass}">
                                    ${score}%
                                </div>
                                <h2>üéØ Job-Optimized Resume Analysis</h2>
                                <p style="margin: 1rem 0; color: #666;">Tailored specifically for this role</p>
                            </div>

                            <!-- Missing Requirements -->
                            <div style="background: #fff5f5; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #ff6b6b; margin: 2rem 0;">
                                <h3 style="color: #d32f2f; margin-bottom: 1rem;">üìã Missing Requirements</h3>
                                <ul style="margin: 0; padding-left: 1rem;">
                                    ${analysis.missing_requirements.map(req => `<li style="margin-bottom: 0.5rem;">${req}</li>`).join('')}
                                </ul>
                            </div>

                            <!-- Keywords to Add -->
                            <div style="background: #f0f8ff; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #2196F3; margin: 2rem 0;">
                                <h3 style="color: #1976D2; margin-bottom: 1rem;">üîë Keywords to Add</h3>
                                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                    ${analysis.optimization_keywords.map(keyword => `<span style="background: #e3f2fd; color: #1976D2; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.9rem;">${keyword}</span>`).join('')}
                                </div>
                            </div>

                            <!-- Resume Improvements -->
                            <div style="background: #f3e5f5; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #9c27b0; margin: 2rem 0;">
                                <h3 style="color: #7b1fa2; margin-bottom: 1rem;">üí° Optimization Recommendations</h3>
                                <ul style="margin: 0; padding-left: 1rem;">
                                    ${analysis.resume_improvements.map(improvement => `<li style="margin-bottom: 0.8rem;">${improvement}</li>`).join('')}
                                </ul>
                            </div>

                            <!-- Competitive Advantage -->
                            <div style="background: #e8f5e8; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #4caf50; margin: 2rem 0;">
                                <h3 style="color: #388e3c; margin-bottom: 1rem;">üåü Your Competitive Advantage</h3>
                                <p style="margin: 0; font-size: 1.1rem; line-height: 1.6;">${analysis.competitive_advantage}</p>
                            </div>
                        `;
                        
                        // Add text rewrites section if available
                        if (analysis.text_rewrites && analysis.text_rewrites.length > 0) {
                            resultsSection.innerHTML += `
                                <div style="margin: 2rem 0;">
                                    <h3 style="color: #2e7d32; margin-bottom: 1rem;">‚úçÔ∏è Ready-to-Use Text Improvements</h3>
                                    ${analysis.text_rewrites.map(rewrite => `
                                        <div class="text-rewrite" style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem;">
                                            <h4 style="color: #1976d2; margin-bottom: 1rem;">${rewrite.section}</h4>
                                            <div style="background: #ffebee; padding: 1rem; border-radius: 4px; margin-bottom: 1rem;">
                                                <strong>Before:</strong> ${rewrite.original}
                                            </div>
                                            <div style="background: #e8f5e8; padding: 1rem; border-radius: 4px; margin-bottom: 1rem;">
                                                <strong>After:</strong> ${rewrite.improved}
                                            </div>
                                            <div style="color: #666; font-style: italic;">
                                                <strong>Why:</strong> ${rewrite.reason}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                            
                            // Add sentiment tracking
                            resultsSection.innerHTML += addSentimentTracking(analysis);
                        }
                    } else {
                        // Display regular detailed paid analysis
                        resultsSection.innerHTML = `
                            <div style="text-align: center;">
                                <div class="score-circle ${scoreClass}">
                                    ${score}/100
                                </div>
                                <h2>üéØ Complete Resume Analysis</h2>
                                <p style="margin: 1rem 0; color: #666;">Comprehensive breakdown with actionable improvements</p>
                            </div>

                        <!-- Free Analysis Recap -->
                        <div style="background: #f0f8ff; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #2196F3; margin: 2rem 0;">
                            <h3 style="color: #1976D2; margin-bottom: 1rem;">üìã Key Issues Summary</h3>
                            <ul style="margin: 0; padding-left: 1rem;">
                                ${analysis.major_issues.map(issue => `<li style="margin-bottom: 0.5rem;">${issue}</li>`).join('')}
                            </ul>
                        </div>

                        <div class="detailed-results">
                            <div class="metric-card">
                                <div class="metric-score">${analysis.ats_optimization.score}/100</div>
                                <h3>ATS Optimization</h3>
                                <h4>Issues:</h4>
                                <ul>
                                    ${analysis.ats_optimization.issues.map(issue => `<li>${issue}</li>`).join('')}
                                </ul>
                                <h4>Improvements:</h4>
                                <ul>
                                    ${analysis.ats_optimization.improvements.map(imp => `<li>${imp}</li>`).join('')}
                                </ul>
                            </div>

                            <div class="metric-card">
                                <div class="metric-score">${analysis.content_clarity.score}/100</div>
                                <h3>Content Clarity</h3>
                                <h4>Issues:</h4>
                                <ul>
                                    ${analysis.content_clarity.issues.map(issue => `<li>${issue}</li>`).join('')}
                                </ul>
                                <h4>Improvements:</h4>
                                <ul>
                                    ${analysis.content_clarity.improvements.map(imp => `<li>${imp}</li>`).join('')}
                                </ul>
                            </div>

                            <div class="metric-card">
                                <div class="metric-score">${analysis.impact_metrics.score}/100</div>
                                <h3>Impact Metrics</h3>
                                <h4>Issues:</h4>
                                <ul>
                                    ${analysis.impact_metrics.issues.map(issue => `<li>${issue}</li>`).join('')}
                                </ul>
                                <h4>Improvements:</h4>
                                <ul>
                                    ${analysis.impact_metrics.improvements.map(imp => `<li>${imp}</li>`).join('')}
                                </ul>
                            </div>

                            <div class="metric-card">
                                <div class="metric-score">${analysis.formatting.score}/100</div>
                                <h3>Formatting</h3>
                                <h4>Issues:</h4>
                                <ul>
                                    ${analysis.formatting.issues.map(issue => `<li>${issue}</li>`).join('')}
                                </ul>
                                <h4>Improvements:</h4>
                                <ul>
                                    ${analysis.formatting.improvements.map(imp => `<li>${imp}</li>`).join('')}
                                </ul>
                            </div>
                        </div>

                        <!-- NEW: Text Rewrites Section -->
                        ${analysis.text_rewrites && analysis.text_rewrites.length > 0 ? `
                            <div style="background: #f8f9fa; padding: 2rem; border-radius: 12px; margin: 2rem 0; border-left: 4px solid #28a745;">
                                <h3 style="color: #155724; margin-bottom: 1.5rem;">‚ú® Ready-to-Use Text Improvements</h3>
                                ${analysis.text_rewrites.map((rewrite, index) => `
                                    <div style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <h4 style="color: #495057; margin-bottom: 1rem;">üìù ${rewrite.section}</h4>
                                        
                                        <div style="margin-bottom: 1rem;">
                                            <strong style="color: #dc3545;">‚ùå Current:</strong>
                                            <div style="background: #fff5f5; padding: 0.8rem; border-radius: 4px; margin: 0.5rem 0; font-style: italic; border-left: 3px solid #dc3545;">
                                                "${rewrite.original}"
                                            </div>
                                        </div>
                                        
                                        <div style="margin-bottom: 1rem;">
                                            <strong style="color: #28a745;">‚úÖ Improved:</strong>
                                            <div style="background: #f0fff4; padding: 0.8rem; border-radius: 4px; margin: 0.5rem 0; border-left: 3px solid #28a745;">
                                                "${rewrite.improved}"
                                            </div>
                                        </div>
                                        
                                        <div style="font-size: 0.9rem; color: #6c757d; font-style: italic;">
                                            üí° <strong>Why this works:</strong> ${rewrite.explanation}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}

                        <!-- NEW: Sample Bullet Improvements -->
                        ${analysis.sample_improvements ? `
                            <div style="background: #e8f5e8; padding: 2rem; border-radius: 12px; margin: 2rem 0; border-left: 4px solid #4CAF50;">
                                <h3 style="color: #2e7d32; margin-bottom: 1.5rem;">üéØ Bullet Point Makeover Examples</h3>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 1rem;">
                                    <div>
                                        <h4 style="color: #d32f2f; margin-bottom: 1rem;">‚ùå Weak Bullets</h4>
                                        ${analysis.sample_improvements.weak_bullets.map(bullet => `
                                            <div style="background: #fff; padding: 1rem; border-radius: 4px; margin-bottom: 0.5rem; border-left: 3px solid #d32f2f;">
                                                ‚Ä¢ ${bullet}
                                            </div>
                                        `).join('')}
                                    </div>
                                    
                                    <div>
                                        <h4 style="color: #388e3c; margin-bottom: 1rem;">‚úÖ Strong Bullets</h4>
                                        ${analysis.sample_improvements.strong_bullets.map(bullet => `
                                            <div style="background: #fff; padding: 1rem; border-radius: 4px; margin-bottom: 0.5rem; border-left: 3px solid #388e3c;">
                                                ‚Ä¢ ${bullet}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        ` : ''}

                        <div class="recommendations">
                            <h3>üéØ Top Priority Action Plan</h3>
                            <ol>
                                ${analysis.top_recommendations.map(rec => `<li>${rec}</li>`).join('')}
                            </ol>
                        </div>
                        
                        <div style="background: #e3f2fd; padding: 1.5rem; border-radius: 8px; text-align: center; margin-top: 2rem;">
                            <h4 style="color: #1565c0; margin-bottom: 0.5rem;">üöÄ Ready to Implement?</h4>
                            <p style="color: #424242; margin: 0;">Copy the improved text above and update your resume to increase your interview rate!</p>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button onclick="resetForNewUpload()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1rem 2rem; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer;">
                                Analyze Another Resume
                            </button>
                        </div>
                    `;
                    
                    // Add sentiment tracking
                    resultsSection.innerHTML += addSentimentTracking(analysis);
                }
            }
            
            // Add sentiment tracking to all analysis results
            function displayResults(analysis) {
                // ... existing code ...
                
                // After displaying results, add sentiment tracking
                setTimeout(() => {
                    const resultsSection = document.getElementById('resultsSection');
                    if (resultsSection && !document.querySelector('.sentiment-tracking')) {
                        resultsSection.innerHTML += addSentimentTracking(analysis);
                    }
                }, 1000); // Small delay to ensure results are fully rendered
            }

            function getScoreClass(score) {
                if (score >= 80) return 'score-excellent';
                if (score >= 60) return 'score-good';
                if (score >= 40) return 'score-fair';
                return 'score-poor';
            }

            function addSentimentTracking(analysis) {
                // Add sentiment tracking UI to results
                return `
                    <div class="sentiment-tracking" style="background: #f8f9fa; padding: 2rem; border-radius: 12px; margin-top: 2rem; text-align: center; border-left: 4px solid #667eea;">
                        <h3 style="color: #333; margin-bottom: 1rem;">üí´ How do you feel about this analysis?</h3>
                        <p style="color: #666; margin-bottom: 1.5rem; font-size: 0.95rem;">Your feedback helps us improve our analysis for everyone!</p>
                        
                        <div class="sentiment-buttons" style="display: flex; flex-wrap: wrap; gap: 0.75rem; justify-content: center; margin-bottom: 1.5rem;">
                            <button onclick="trackSentiment('motivated', 5, 'üöÄ Ready to apply!')" class="sentiment-btn" style="background: #4caf50; color: white; border: none; padding: 0.75rem 1.25rem; border-radius: 25px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;">
                                üöÄ Motivated to apply!
                            </button>
                            <button onclick="trackSentiment('confident', 4, 'üí™ More confident')" class="sentiment-btn" style="background: #2196f3; color: white; border: none; padding: 0.75rem 1.25rem; border-radius: 25px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;">
                                üí™ More confident
                            </button>
                            <button onclick="trackSentiment('hopeful', 3, '‚ú® Feeling hopeful')" class="sentiment-btn" style="background: #ff9800; color: white; border: none; padding: 0.75rem 1.25rem; border-radius: 25px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;">
                                ‚ú® Feeling hopeful
                            </button>
                            <button onclick="trackSentiment('neutral', 2, 'üòê Somewhat helpful')" class="sentiment-btn" style="background: #607d8b; color: white; border: none; padding: 0.75rem 1.25rem; border-radius: 25px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;">
                                üòê Somewhat helpful
                            </button>
                            <button onclick="trackSentiment('discouraged', 1, 'üòî Feeling discouraged')" class="sentiment-btn" style="background: #f44336; color: white; border: none; padding: 0.75rem 1.25rem; border-radius: 25px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;">
                                üòî Need more help
                            </button>
                        </div>
                        
                        <div class="detailed-feedback" style="display: none; margin-top: 1rem;" id="detailedFeedback">
                            <p style="color: #666; font-size: 0.9rem; margin-bottom: 0.75rem;">What was most helpful? (optional)</p>
                            <input type="text" id="specificFeedback" placeholder="e.g., The keyword suggestions really helped..." style="width: 100%; max-width: 400px; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem;" />
                            <button onclick="submitDetailedFeedback()" style="background: #667eea; color: white; border: none; padding: 0.6rem 1.25rem; border-radius: 6px; cursor: pointer; margin-left: 0.5rem; font-size: 0.9rem;">
                                Share
                            </button>
                        </div>
                        
                        <div class="sentiment-thanks" style="display: none; color: #4caf50; font-weight: 600; margin-top: 1rem;" id="sentimentThanks">
                            Thank you for your feedback! üôè
                        </div>
                    </div>
                `;
            }

            function trackSentiment(sentimentLabel, sentimentScore, buttonText) {
                // Track user sentiment and show detailed feedback form
                if (!currentAnalysis || !currentAnalysis.session_id) {
                    console.warn('No session ID available for sentiment tracking');
                    return;
                }
                
                // Send sentiment data to server
                fetch('/api/track-sentiment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        session_id: currentAnalysis.session_id,
                        sentiment_score: sentimentScore,
                        sentiment_label: sentimentLabel,
                        product: currentAnalysis.analysis_type || 'unknown',
                        user_path: window.location.pathname
                    })
                }).then(response => {
                    if (response.ok) {
                        console.log('Sentiment tracked successfully');
                    }
                }).catch(error => {
                    console.error('Failed to track sentiment:', error);
                });
                
                // Update UI
                const buttons = document.querySelectorAll('.sentiment-btn');
                buttons.forEach(btn => {
                    btn.style.opacity = '0.3';
                    btn.disabled = true;
                });
                
                // Highlight selected button
                event.target.style.opacity = '1';
                event.target.style.transform = 'scale(1.05)';
                
                // Show detailed feedback form for positive responses
                if (sentimentScore >= 3) {
                    setTimeout(() => {
                        document.getElementById('detailedFeedback').style.display = 'block';
                    }, 500);
                } else {
                    // For negative feedback, show thanks immediately
                    setTimeout(() => {
                        document.getElementById('sentimentThanks').style.display = 'block';
                    }, 500);
                }
            }

            function submitDetailedFeedback() {
                // Submit detailed feedback
                const specificFeedback = document.getElementById('specificFeedback').value.trim();
                
                if (specificFeedback && currentAnalysis && currentAnalysis.session_id) {
                    // Update the previous sentiment entry with specific feedback
                    fetch('/api/track-sentiment', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            session_id: currentAnalysis.session_id,
                            sentiment_score: 0, // Indicator for follow-up feedback
                            sentiment_label: 'detailed_feedback',
                            specific_feedback: specificFeedback
                        })
                    });
                }
                
                // Hide form and show thanks
                document.getElementById('detailedFeedback').style.display = 'none';
                document.getElementById('sentimentThanks').style.display = 'block';
            }

            // Show product selection after free analysis (proper freemium flow)
            function showProductSelectionAfterFree() {
                console.log('üéØ User wants premium analysis, showing product options...');
                
                const productSelection = document.getElementById('productSelection');
                if (productSelection) {
                    // Show the product selection section
                    productSelection.style.display = 'block';
                    
                    // Smooth scroll to product selection
                    productSelection.scrollIntoView({ 
                        behavior: 'smooth',
                        block: 'start'
                    });
                    
                    // Update the header to show this is premium upgrade
                    const sectionHeader = productSelection.querySelector('.section-header h2');
                    if (sectionHeader) {
                        sectionHeader.innerHTML = 'üöÄ Choose Your Premium Analysis';
                    }
                    
                    const sectionSubheader = productSelection.querySelector('.section-header p');
                    if (sectionSubheader) {
                        sectionSubheader.innerHTML = 'Upgrade from your free analysis to get detailed insights and recommendations';
                    }
                    
                    console.log('‚úÖ Product selection shown after free analysis');
                } else {
                    console.error('‚ùå Could not find productSelection element');
                }
            }

            function goToStripeCheckout() {
                // Save the current file to localStorage before going to Stripe
                if (selectedFile) {
                    // Generate unique session ID
                    const sessionId = crypto.randomUUID();
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const fileData = {
                            name: selectedFile.name,
                            type: selectedFile.type,
                            data: e.target.result.split(',')[1] // Remove data URL prefix
                        };
                        // Store with unique session-based key for user isolation
                        const storageKey = `resume_session_${sessionId}`;
                        const metadataKey = `resume_meta_${sessionId}`;
                        
                        // Store file data
                        localStorage.setItem(storageKey, JSON.stringify(fileData));
                        
                        // Store session metadata with timestamp for cleanup
                        const metadata = {
                            sessionId: sessionId,
                            timestamp: Date.now(),
                            fileName: fileData.name,
                            status: 'pending_payment'
                        };
                        localStorage.setItem(metadataKey, JSON.stringify(metadata));
                        
                        // Store session ID in URL hash for retrieval after payment
                        window.location.hash = `session=${sessionId}`;
                        
                        console.log('üíæ Stored file with unique session:', sessionId);
                        
                        // Go to Stripe Payment Link (use dynamic pricing URL)
                        const stripeUrl = currentPricing.stripe_url || 'STRIPE_PAYMENT_URL_PLACEHOLDER';
                        window.location.href = stripeUrl;
                    };
                    reader.readAsDataURL(selectedFile);
                } else {
                    alert('Please upload a resume first before upgrading.');
                }
            }

            // Reset function for new uploads
            function resetForNewUpload() {
                console.log('Reset function called'); // Debug log
                
                // Clear current state
                selectedFile = null;
                currentAnalysis = null;
                
                // Clear URL parameters
                const url = new URL(window.location);
                url.searchParams.delete('payment_token');
                url.searchParams.delete('client_reference_id');
                window.history.replaceState({}, document.title, url);
                
                // Reset upload UI
                const uploadDiv = document.querySelector('.file-upload');
                if (uploadDiv) {
                    uploadDiv.innerHTML = `
                        <input type="file" id="fileInput" accept=".pdf,.docx" onchange="handleFileSelect(event)" style="display: none;">
                        <div class="upload-text">
                            <strong>Click to upload your resume</strong><br>
                            or drag and drop it here
                        </div>
                        <div class="file-types">Supports PDF and Word documents</div>
                    `;
                    
                    // Re-add click handler
                    uploadDiv.onclick = function() {
                        document.getElementById('fileInput').click();
                    };
                } else {
                    console.error('Upload div not found');
                }
                
                // Reset analyze button
                const analyzeBtn = document.getElementById('analyzeBtn');
                if (analyzeBtn) {
                    analyzeBtn.disabled = true;
                    analyzeBtn.textContent = 'Analyze My Resume - FREE';
                } else {
                    console.error('Analyze button not found');
                }
                
                // Hide results section
                const resultsSection = document.getElementById('resultsSection');
                if (resultsSection) {
                    resultsSection.style.display = 'none';
                } else {
                    console.error('Results section not found');
                }
                
                // Re-add drag and drop functionality
                setTimeout(() => setupDragAndDrop(), 100); // Small delay to ensure DOM is ready
            }
            
            // Function to setup drag and drop (extracted for reuse)
            function setupDragAndDrop() {
                const fileUpload = document.querySelector('.file-upload');
                
                fileUpload.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    fileUpload.classList.add('dragover');
                });
                
                fileUpload.addEventListener('dragleave', () => {
                    fileUpload.classList.remove('dragover');
                });
                
                fileUpload.addEventListener('drop', (e) => {
                    e.preventDefault();
                    fileUpload.classList.remove('dragover');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const file = files[0];
                        if (file.type === 'application/pdf' || file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {
                            selectedFile = file;
                            document.getElementById('fileInput').files = files;
                            handleFileSelect({ target: { files: [file] } });
                        } else {
                            alert('Please upload a PDF or Word document');
                        }
                    }
                });
            }
            
            // Initial setup of drag and drop
            setupDragAndDrop();
            
            // Load pricing configuration on page load  
            console.log('üöÄ Initializing pricing...');
            
            // Simple test to verify DOM access works
            const testGrid = document.getElementById('productsGrid');
            if (testGrid) {
                console.log('‚úÖ Found productsGrid element');
                testGrid.innerHTML = `
                    <div style="border: 2px solid #667eea; border-radius: 12px; padding: 1.5rem; text-align: center; background: #f0f2ff;">
                        <span style="font-size: 2rem;">üìã</span>
                        <div style="font-weight: 700; margin: 0.5rem 0;">Test Product Card</div>
                        <div style="color: #666;">$10 - Testing if DOM manipulation works</div>
                    </div>
                `;
                console.log('‚úÖ Test card added to DOM');
            } else {
                console.error('‚ùå productsGrid element not found!');
            }
            
            try {
                loadPricingConfig();
                loadMultiProductPricing();
                console.log('‚úÖ Function calls completed');
            } catch (error) {
                console.error('‚ùå Error during initialization:', error);
            }
            
            // Load multi-product pricing and render products
            async function loadMultiProductPricing() {
                try {
                    // Detect user's country first (reuse existing logic)
                    let countryCode = 'US';  // Default
                    
                    const urlParams = new URLSearchParams(window.location.search);
                    const testCountry = urlParams.get('test_country');
                    
                    if (testCountry) {
                        countryCode = testCountry.toUpperCase();
                        console.log('üß™ TEST MODE: Using country:', countryCode);
                    } else {
                        try {
                            const geoResponse = await fetch('https://ipapi.co/json/');
                            const geoData = await geoResponse.json();
                            if (geoData.country_code) {
                                countryCode = geoData.country_code;
                            }
                            console.log('üåç Detected country:', countryCode);
                        } catch (e) {
                            console.log('IP geolocation failed, using default USD pricing');
                        }
                    }
                    
                    // Try new Stripe pricing API first
                    console.log('üí∞ Fetching regional pricing from Stripe...');
                    let response = await fetch(`/api/stripe-pricing/${countryCode}`);
                    let pricingData = await response.json();
                    
                    console.log('üìä Stripe pricing loaded:', pricingData);
                    
                    // Transform Stripe pricing data to multi-product format
                    console.log('üîÑ Transforming Stripe data...');
                    multiProductPricing = await transformStripePricingToMultiProduct(pricingData, countryCode);
                    console.log('‚úÖ Transformation complete, result:', multiProductPricing);
                    
                    // Store detected country for checkout
                    window.detectedCountry = countryCode;
                    window.currentRegionPricing = pricingData;
                    
                    // Render individual products with Stripe pricing
                    renderProducts();
                    
                } catch (error) {
                    console.error('Error loading Stripe pricing:', error);
                    
                    // Fallback to static multi-product pricing
                    try {
                        console.log('üìÅ Falling back to static multi-product pricing...');
                        const fallbackResponse = await fetch('/api/multi-product-pricing');
                        multiProductPricing = await fallbackResponse.json();
                        
                        console.log('üìä Multi-product pricing loaded:', multiProductPricing);
                        renderProducts();
                        
                    } catch (fallbackError) {
                        console.error('Error loading fallback pricing:', fallbackError);
                        // Show error message
                        document.getElementById('productsGrid').innerHTML = `
                            <div style="text-align: center; color: #666; grid-column: 1 / -1;">
                                <p>Unable to load product options. Please refresh the page.</p>
                            </div>
                        `;
                    }
                }
            }
            
            async function transformStripePricingToMultiProduct(stripePricing, countryCode) {
                /**
                 * Transform Stripe pricing format to multi-product format for UI compatibility
                 */
                console.log('üîß transformStripePricingToMultiProduct called with:', stripePricing, countryCode);
                
                // Get static product metadata (names, descriptions, emojis)
                let staticConfig;
                try {
                    const staticResponse = await fetch('/api/multi-product-pricing');
                    staticConfig = await staticResponse.json();
                } catch (e) {
                    console.warn('Could not load static config, using minimal fallback');
                    staticConfig = { products: {}, bundles: {} };
                }
                
                const transformed = {
                    metadata: {
                        version: "3.0.0-stripe",
                        last_updated: stripePricing.fetched_at,
                        description: `Regional pricing for ${stripePricing.region} via Stripe API`,
                        source: stripePricing.source || "stripe"
                    },
                    products: {},
                    bundles: {}
                };
                
                // Transform individual products
                Object.keys(stripePricing.products || {}).forEach(productId => {
                    const stripeProduct = stripePricing.products[productId];
                    const staticProduct = staticConfig.products?.[productId] || {};
                    
                    transformed.products[productId] = {
                        name: staticProduct.name || getProductDisplayName(productId),
                        emoji: staticProduct.emoji || getProductEmoji(productId),
                        description: staticProduct.description || `${getProductDisplayName(productId)} service`,
                        benefits: staticProduct.benefits || [`Optimized ${getProductDisplayName(productId).toLowerCase()}`],
                        individual_price: {
                            amount: stripeProduct.amount,
                            currency: stripeProduct.currency,
                            display: stripeProduct.display,
                            stripe_url: stripeProduct.payment_link
                        },
                        processing_time: staticProduct.processing_time || "2-3 minutes"
                    };
                });
                
                // Transform bundles (if available from Stripe)
                Object.keys(stripePricing.bundles || {}).forEach(bundleId => {
                    const stripeBundle = stripePricing.bundles[bundleId];
                    const staticBundle = staticConfig.bundles?.[bundleId] || {};
                    
                    transformed.bundles[bundleId] = {
                        name: staticBundle.name || getBundleDisplayName(bundleId),
                        emoji: staticBundle.emoji || getBundleEmoji(bundleId),
                        description: staticBundle.description || `${getBundleDisplayName(bundleId)} package`,
                        includes: staticBundle.includes || [],
                        bundle_price: {
                            amount: stripeBundle.amount,
                            currency: stripeBundle.currency,
                            display: stripeBundle.display,
                            stripe_url: stripeBundle.payment_link
                        },
                        savings: stripeBundle.savings || { amount: 0, display: "" },
                        popular: staticBundle.popular || false,
                        best_value: staticBundle.best_value || false
                    };
                });
                
                // Add regional pricing context
                transformed.region_info = {
                    country_code: countryCode,
                    currency: stripePricing.currency,
                    symbol: stripePricing.symbol,
                    source: stripePricing.source
                };
                
                console.log('üîÑ Transformed Stripe pricing to multi-product format:', transformed);
                return transformed;
            }
            
            function getProductDisplayName(productId) {
                const names = {
                    "resume_analysis": "Resume Health Check",
                    "job_fit_analysis": "Job Fit Analysis", 
                    "cover_letter": "Cover Letter Generator"
                };
                return names[productId] || productId.replace('_', ' ');
            }
            
            function getProductEmoji(productId) {
                const emojis = {
                    "resume_analysis": "üìã",
                    "job_fit_analysis": "üéØ",
                    "cover_letter": "‚úçÔ∏è"
                };
                return emojis[productId] || "üíº";
            }
            
            function getBundleDisplayName(bundleId) {
                const names = {
                    "career_boost": "Career Boost Bundle",
                    "job_hunter": "Job Hunter Bundle",
                    "complete_package": "Complete Job Search Package"
                };
                return names[bundleId] || bundleId.replace('_', ' ');
            }
            
            function getBundleEmoji(bundleId) {
                const emojis = {
                    "career_boost": "üöÄ",
                    "job_hunter": "üéØ", 
                    "complete_package": "üíº"
                };
                return emojis[bundleId] || "üì¶";
            }
            
            // Render individual products
            function renderProducts() {
                console.log('üé® renderProducts called, multiProductPricing:', multiProductPricing);
                if (!multiProductPricing || !multiProductPricing.products) {
                    console.log('‚ùå renderProducts: Missing data, multiProductPricing:', multiProductPricing);
                    document.getElementById('productsGrid').innerHTML = '<div style="color: red;">Debug: No product data available</div>';
                    return;
                }
                
                const productsGrid = document.getElementById('productsGrid');
                const products = multiProductPricing.products;
                
                productsGrid.innerHTML = Object.keys(products).map(productId => {
                    const product = products[productId];
                    const tagline = multiProductPricing.hope_driven_messaging.taglines[productId];
                    
                    return `
                        <div class="product-card" onclick="selectProduct('individual', '${productId}')" data-product-id="${productId}">
                            <span class="product-emoji">${product.emoji}</span>
                            <div class="product-name">${product.name}</div>
                            <div class="product-description">${tagline}</div>
                            <div class="product-benefits">
                                <ul>
                                    ${product.benefits.map(benefit => `<li>${benefit}</li>`).join('')}
                                </ul>
                            </div>
                            <div class="product-price">${product.individual_price.display}</div>
                            <div class="product-time">${product.processing_time}</div>
                        </div>
                    `;
                }).join('');
                
                // Add "See Bundle Options" call-to-action
                productsGrid.innerHTML += `
                    <div class="product-card bundle-cta" onclick="showBundleOptions()" style="background: linear-gradient(135deg, #ff6b6b15, #4caf5015); border-color: #ff6b6b;">
                        <span class="product-emoji">üéØ</span>
                        <div class="product-name">Bundle & Save</div>
                        <div class="product-description">Get multiple services and save up to 27%</div>
                        <div class="product-benefits">
                            <ul>
                                <li>Complete job search toolkit</li>
                                <li>Save $3-$8 on bundles</li>
                                <li>Comprehensive career support</li>
                                <li>Priority processing</li>
                            </ul>
                        </div>
                        <div class="product-price" style="color: #ff6b6b;">View Bundles</div>
                        <div class="product-time">Best Value!</div>
                    </div>
                `;
            }
            
            // Show bundle options
            function showBundleOptions() {
                if (!showingBundles) {
                    renderBundles();
                    document.getElementById('bundleSection').style.display = 'block';
                    showingBundles = true;
                    
                    // Scroll to bundles section
                    document.getElementById('bundleSection').scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                }
            }
            
            // Render bundles
            function renderBundles() {
                if (!multiProductPricing || !multiProductPricing.bundles) return;
                
                const bundlesGrid = document.getElementById('bundlesGrid');
                const bundles = multiProductPricing.bundles;
                
                bundlesGrid.innerHTML = Object.keys(bundles).map(bundleId => {
                    const bundle = bundles[bundleId];
                    const tagline = multiProductPricing.hope_driven_messaging.taglines[bundleId];
                    
                    let badgeText = '';
                    let badgeClass = '';
                    if (bundle.popular) {
                        badgeText = 'Popular';
                        badgeClass = '';
                    } else if (bundle.best_value) {
                        badgeText = 'Best Value';
                        badgeClass = 'best-value';
                    }
                    
                    const includedProducts = bundle.includes.map(productId => 
                        multiProductPricing.products[productId].name
                    );
                    
                    return `
                        <div class="bundle-card" onclick="selectProduct('bundle', '${bundleId}')" data-bundle-id="${bundleId}">
                            ${badgeText ? `<div class="bundle-badge ${badgeClass}">${badgeText}</div>` : ''}
                            <span class="product-emoji">${bundle.emoji}</span>
                            <div class="bundle-name">${bundle.name}</div>
                            <div class="bundle-description">${tagline}</div>
                            <div class="bundle-includes">
                                <h4>Includes:</h4>
                                <ul>
                                    ${includedProducts.map(productName => `<li>${productName}</li>`).join('')}
                                </ul>
                            </div>
                            <div class="bundle-pricing">
                                <span class="bundle-original-price">$${bundle.individual_total}</span>
                                <span class="bundle-price">${bundle.bundle_price.display}</span>
                            </div>
                            <div class="bundle-savings">${bundle.savings.display}</div>
                        </div>
                    `;
                }).join('');
            }
            
            // Select a product or bundle
            function selectProduct(type, id) {
                // Clear previous selections
                document.querySelectorAll('.product-card, .bundle-card').forEach(card => {
                    card.classList.remove('selected');
                });
                
                // Mark new selection
                const selector = type === 'individual' 
                    ? `[data-product-id="${id}"]` 
                    : `[data-bundle-id="${id}"]`;
                document.querySelector(selector).classList.add('selected');
                
                // Update selection state
                selectedProductType = type;
                selectedProductId = id;
                
                // Show selection summary
                showSelectionSummary(type, id);
            }
            
            // Show selection summary
            function showSelectionSummary(type, id) {
                const selectedProduct = document.getElementById('selectedProduct');
                const selectedItem = document.getElementById('selectedItem');
                
                let itemData;
                if (type === 'individual') {
                    itemData = multiProductPricing.products[id];
                    const tagline = multiProductPricing.hope_driven_messaging.taglines[id];
                    
                    selectedItem.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: center; gap: 1rem;">
                            <span style="font-size: 2rem;">${itemData.emoji}</span>
                            <div style="text-align: left;">
                                <div style="font-weight: 700; font-size: 1.1rem; color: #333;">${itemData.name}</div>
                                <div style="color: #666; font-size: 0.9rem;">${tagline}</div>
                                <div style="color: #667eea; font-weight: 700; font-size: 1.2rem; margin-top: 0.5rem;">
                                    ${itemData.individual_price.display}
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    itemData = multiProductPricing.bundles[id];
                    const tagline = multiProductPricing.hope_driven_messaging.taglines[id];
                    
                    selectedItem.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: center; gap: 1rem;">
                            <span style="font-size: 2rem;">${itemData.emoji}</span>
                            <div style="text-align: left;">
                                <div style="font-weight: 700; font-size: 1.1rem; color: #333;">${itemData.name}</div>
                                <div style="color: #666; font-size: 0.9rem;">${tagline}</div>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem;">
                                    <span style="color: #888; text-decoration: line-through;">$${itemData.individual_total}</span>
                                    <span style="color: #ff6b6b; font-weight: 700; font-size: 1.2rem;">${itemData.bundle_price.display}</span>
                                    <span style="background: #4caf50; color: white; padding: 0.2rem 0.4rem; border-radius: 4px; font-size: 0.8rem;">
                                        ${itemData.savings.display}
                                    </span>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                selectedProduct.style.display = 'block';
                
                // Scroll to selection
                selectedProduct.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
            }
            
            // Show upload section after product selection
            function showUploadSection() {
                document.getElementById('uploadSection').style.display = 'block';
                document.getElementById('uploadSection').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }

            // If payment token is present, automatically analyze the previously uploaded resume
            const urlParams = new URLSearchParams(window.location.search);
            const currentPaymentToken = urlParams.get('payment_token');
            if (currentPaymentToken && selectedFile) {
                analyzeResume();
            }
            
        }
        </script>
    </body>
    </html>
